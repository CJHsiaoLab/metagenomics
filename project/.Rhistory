libsize <- colSums(MRcounts(msd_subset))
plot(log2(libsize[order(libsize)]), type = "h",
ylab = "Sampling depth (log2 library size)",
xlab = "Sample ordered by sampling depth")
abline(v = log2(1000), col = "red")
# 0 if 0 gene count, and 1 if > 0 gene count
gene_present <- rowSums(MRcounts(msd_subset) > 0)
plot(gene_present, type = "h",
ylab = "Frequency",
xlab = "No. of genes that have with at least 1 count")
count_filtered <- filterData(MRcounts(msd_subset), present = 10, depth = 100)
sum( is.na(count_filtered) )
# Per gene proportion of present samples
prop_present <- rowSums(count_filtered > 0)/ncol(count_filtered)
summary(prop_present)
unique(country)
age_factor
pData(count_filtered)
per_age_group = 1
ii_phenoSelect <- pData(msd_subset)$country == unique(country)[per_country] &
pData(msd_subset)$age_factor == unique(age_factor)[per_age_group]
per_country = 1
ii_phenoSelect <- pData(msd_subset)$country == unique(country)[per_country] &
pData(msd_subset)$age_factor == unique(age_factor)[per_age_group]
pData(msd_subset)$country
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$age_factor == unique(age_factor)[per_age_group]
pData(msd_subset)$Country
unique(country)
per_country
pData(msd_subset)$age
pData(msd_subset)
head(pData(msd_subset))
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
topics_country <- lapply(1: length(unique(country)), function(per_country)  {
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
}
}
topics_country <- lapply(1: length(unique(country)), function(per_country)  {
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
})
names(topics_age) <- unique(age_factor)
})
names(topics_country) <- unique(country)
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
unique(age_factor)
topics_country <- lapply(1: length(unique(country)), function(per_country)  {
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
names(topics_age) <- unique(age_factor)
return(topics_age)
})
traceback()
unique(country)
per_country = 2
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
names(topics_age) <- unique(age_factor)
per_country = 1
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .001)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
names(topics_age) <- unique(age_factor)
per_country = 2
install_github("Taddylab/maptpx")
require(devtools)
install_github("Taddylab/maptpx")
install_github("TaddyLab/maptpx")
install_github("TaddyLab/maptpx")
install.packages("maptpx")
install.packages("maptpx")
ls()
per_country = 2
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .005)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
sessionInfo()
topics_country <- lapply(1: length(unique(country)), function(per_country)  {
topics_age <- lapply(1: length(unique(age_factor)), function(per_age_group) {
ii_phenoSelect <- pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group]
count_subset <- count_filtered[ , ii_phenoSelect]
topics_list <- lapply(2:10, function(per_clust) {
maptpx::topics(t(count_subset), K = per_clust, tol = .005)
})
names(topics_list) <- paste("nclust", c(2:10), sep = "")
return(topics_list)
})
names(topics_age) <- unique(age_factor)
return(topics_age)
})
names(topics_country) <- unique(country)
save(topics_country, file = "../rdas/topics-diarrhea.rda")
getwd()
save(topics_country, file = "./rdas/topics-diarrhea.rda")
names(topics_country)
nclust <- length(topics_gambia[[1]])
topics_gambia <- topics_country[[1]]
nclust <- length(topics_gambia[[1]])
nclust
names(topics_gambia)
head(pData(msd_subset))
type_info <- pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia"]
type_info
for (per_clust in 1:2) {
topics_plot <- topics_gambia[[1]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info)]
docweights_ordered <- docweights[order(type_info),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered), type_ordered)
abline(v=labels-1)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered), las = 2, cex.axis=0.3)
}
for (per_clust in 1:2) {
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info)]
docweights_ordered <- docweights[order(type_info),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered), type_ordered)
abline(v=labels-1)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered), las = 2, cex.axis=0.3)
}
per_clust = 1
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
dim(type_info)
str(type_info)
str(docweights)
age_factor[1]
age_factor[age_factor==1]
unique(age_factor)[1]
type_info <- pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ]
str(type_info)
per_clust = 1
for (per_clust in 1:2) {
type_info <- pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ]
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info)]
docweights_ordered <- docweights[order(type_info),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered), type_ordered)
abline(v=labels-1)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered), las = 2, cex.axis=0.3)
}
per_clust = 1
for (per_clust in 1:2) {
type_info <- pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ]
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info)]
docweights_ordered <- docweights[order(type_info),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered), type_ordered)
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered), las = 2, cex.axis=0.3)
}
pData(msd_subset)
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ] )
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info)]
docweights_ordered <- docweights[order(type_info),]
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ] )
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered), las = 2, cex.axis=0.3)
for (per_clust in 1:2) {
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ] )
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2])]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
}
unique(type_ordered[,1])
type_ordered[,1]
type_ordered
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ] )
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
per_clust = 1
for (per_clust in 1:2) {
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == "Gambia" &
pData(msd_subset)$AgeFactor == unique(age_factor)[1] ] )
topics_plot <- topics_gambia[[1]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
}
unique(age_factor)
unique(age_factor)[1]
unique(age_factor)[2]
unique(age_factor)[3]
structure_plot <- function(per_country, per_age_group, topics_country) {
topics_per_country <- topics_country[[per_country]]
nclust <- length(topics_per_country[[per_country]])
names(topics_per_country)
par(mfrow = c(3,3), mar = c(3, 3, 3, 2), cex.main = .8)
for (per_clust in 1:nclust) {
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
}
}
unique(age_factor)
unique(age_factor)[5]
unique(age_factor)[1]
unique(age_factor)[2]
unique(age_factor)[3]
unique(age_factor)[2]
unique(age_factor)[4]
unique(country)
unique(country)[1]
unique(country)[2]
structure_plot <- function(per_country, per_age_group, topics_country, msd_subset) {
topics_per_country <- topics_country[[per_country]]
nclust <- length(topics_per_country[[per_country]])
names(topics_per_country)
par(mfrow = c(3,3), mar = c(3, 3, 3, 2), cex.main = .8)
for (per_clust in 1:nclust) {
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
}
}
structure_plot(per_country = 1, per_age_group = 1, topics_country, msd_subset)
per_country = 1
per_age_group = 1
topics_per_country <- topics_country[[per_country]]
nclust <- length(topics_per_country[[per_country]])
names(topics_per_country)
par(mfrow = c(3,3), mar = c(3, 3, 3, 2), cex.main = .8)
for (per_clust in 1:nclust) {
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
}
nclust = 1
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
docweights <- topics_plot$omega
docweights
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
docweights_ordered
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
type_info
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
type_info
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == per_country &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
type_info
str(type_info)
type_info <- cbind(pData(msd_subset)$center[pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ],
pData(msd_subset)$Age[pData(msd_subset)$Country == unique(country)[per_country] &
pData(msd_subset)$AgeFactor == unique(age_factor)[per_age_group] ] )
topics_plot <- topics_per_country[[per_age_group]][[per_clust]]
clust <- topics_plot$K
docweights <- topics_plot$omega
type_ordered <- type_info[order(type_info[,1], type_info[,2]), ]
docweights_ordered <- docweights[order(type_info[,1], type_info[,2]),]
barplot( t(docweights_ordered),
col = 2:(clust+1), axisnames = F,
space = 0, border=NA,
main = paste("No. of clusters=", clust), las = 1,
ylim = c(0,1), cex.axis = 0.3, cex.main=1.4)
labels <- match(unique(type_ordered[,1]), type_ordered[,1])
abline(v=labels-1, lwd =3)
labels_low <- labels-1
labels_up <- c(labels_low[2:length(labels_low)], dim(docweights_ordered)[1])
mid_point <- labels_low +0.5*(labels_up-labels_low)
axis(1, at = mid_point, unique(type_ordered[,1]), las = 2, cex.axis=0.3)
